<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="page.css">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>
<body onload="servePage()">

<div class="header">
    <h1>Real Estate Development Matrix</h1>

    <div id="matrix">
        <!--THIS CONTENT WILL BE SERVED VIA NAVIGATION SCRIPTS-->
    </div>
</div>

<div class="center-wrapper">
    <div id="top-nav">
        <button id="upBtn" type="button" onclick="incrementContent(0, -1)">UP ARROW</button>
    </div>


    <div id="left-nav">
        <button id="leftBtn" type="button" onclick="incrementContent(-1, 0)">LEFT ARROW</button>
    </div>

    <div id="main-view">
        <!--THIS CONTENT WILL BE SERVED VIA NAVIGATION SCRIPTS-->
        THIS CONTENT IS BLANK FOR NOW
    </div>

    <div id="right-nav">
        <button id="rightBtn" type="button" onclick="incrementContent(1, 0)">RIGHT ARROW</button>
    </div>


    <div id="bottom-nav">
        <button id="downBtn" type="button" onclick="incrementContent(0, 1)">DOWN ARROW</button>
    </div>
</div>

<div id="comments">

    <form method='post'>
        Name:<br/>
        <input type='text' name='name' id='name'/>
        <br/>
        Comment:<br/>
        <textarea name='comment' id='comment'></textarea><br/>
        <input type='submit' value='Submit'/>
    </form>

    <div id="breakpoint"></div>

</div>

<script>

    var MAX_TASKS = 3;
    var MAX_STAGE = 3;

    var currentStage = 1;
    var currentTask = 1;

    var matrix;

    function servePage() {
        try {
            serveMatrix();
        }
        catch (error) {
            alert(error);
        }

        try {
            serveComments();
        }
        catch (error) {
            alert(error);
        }
    }

    function serveMatrix() {
        var URL = "/DevelopmentMatrix/rest/matrix";
        $.get(URL, function (json) {

            var content = JSON.parse(json);
            matrix = content.matrix;
            var length = matrix.length;


            var taskSequence = [];
            for (var i = 0; i < MAX_TASKS; i++) {

                for (var j = 0; j < length; j++) {

                    var stage = matrix[j].stage;
                    var stageTasks = stage.tasks;

                    var currentTask = stageTasks[i].task;
                    var taskContent = currentTask.content;
                    var taskTitle = currentTask.title;

                    //If theres already content, add to it
                    var currentTaskHtml = taskSequence[i];
                    if (typeof currentTaskHtml == 'undefined') {
                        currentTaskHtml = "";
                    }

                    var updatedTaskHtml = currentTaskHtml + '<td onclick="serveContent(' + j + ',' + i + ')">' + taskTitle + '</td>';
                    taskSequence[i] = updatedTaskHtml;
                }
            }

            var matrixContent = "";
            for (var i = 0; i < taskSequence.length; i++) {

                var content = taskSequence[i];

                var tableWrapper = '<tr>' + content + '</tr>';
                matrixContent = matrixContent + tableWrapper;
            }

            var tableWrapper = '<table>' + matrixContent + '</table>';

            document.getElementById("matrix").innerHTML = tableWrapper;

            serveContent(0, 0);

        });
    }


    function serveContent(stageIndex, taskIndex) {

        currentStage = stageIndex;
        currentTask = taskIndex;

        validateButtons();

        var task = retrieveTask(currentStage, currentTask);
        var title = task.title;
        var content = task.content;

        var servedContent = '<p>Title:' + title + '</p><p>Content:' + content + '</p>';

        document.getElementById("main-view").innerHTML = servedContent;
    }

    function incrementContent(stageIncrement, taskIncrement) {

        var stage = currentStage + stageIncrement;
        var task = currentTask + taskIncrement;

        serveContent(stage, task);

    }

    function serveComments() {

        var comments = retrieveComments();

        var insert = "";
        for (var i = 0; i < comments.length; i++) {

            var comment = comments[i].comment;
            var name = comment.name;
            var value = comment.value;

            var nextComment = '<div class="existing-comment">' + value + '</div>';
            insert = insert + nextComment;
        }

        document.getElementById("breakpoint").innerHTML = insert;

    }

    function retrieveComments() {

        var response = '{"comments":[{"comment":{"name":"Kim","value":"I think this could work"}},{"comment":{"name":"Shane","value":"Do you think this could work?"}}]}';

        var comments = JSON.parse(response);
        return comments.comments;
    }


    function retrieveTask(stage, task) {

        var stage = matrix[stage].stage;
        var stageTasks = stage.tasks;
        var task = stageTasks[task];

        return task.task;
    }


    function validateButtons() {

        alert("STAGE: " + currentStage + " TASK: " + currentTask);
        //UP
        if (currentTask <= 1) {
            document.getElementById("upBtn").disabled = true;
        }
        else {
            document.getElementById("upBtn").disabled = false;
        }

        //DOWN
        if (currentTask >= MAX_STAGE) {
            document.getElementById("downBtn").disabled = true;
        }
        else {
            document.getElementById("downBtn").disabled = false;
        }

        //LEFT
        if (currentStage <= 1) {
            document.getElementById("leftBtn").disabled = true;
        }
        else {
            document.getElementById("leftBtn").disabled = false;
        }

        //RIGHT
        if (currentStage >= MAX_TASKS) {
            document.getElementById("rightBtn").disabled = true;
        }
        else {
            document.getElementById("rightBtn").disabled = false;
        }


    }

</script>


</body>
</html>