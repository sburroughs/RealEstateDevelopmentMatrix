<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="css/simple-line-icons.css">
    <link rel="stylesheet" type="text/css" href="css/page.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>
<body onload="servePage()">

<header class="container">
  <div class="site__name">Site Name Goes Here</div>
  <nav class="menu--main">
    <a href="#">Matrix</a>
    <a href="#">Third Dimension</a>
    <a href="#">Process of Real Estate Development</a>
    <a href="#">Handbook</a>
    <a href="#">Glossary</a>
  </nav>
</header>

<div class="main-content container">
    <h1>Real Estate Development Matrix</h1>

    <h2>A Multi-Disciplinary Project</h2>

    <p>The real estate development process is organized around a 56-cell, stage-task matrix, which describes the entire
        real estate development process in seven stages from the land banking stage to the redevelopment stage. In each
        stage, there are eight categories of tasks that need to be addressed. The main thesis of this interdisciplinary
        development model is that there are discrete stages in the process, and in each stage the real estate developer
        must (1) complete different tasks using specialized skills and thereby accepting certain risks and (2) employ
        various capital structures with different risk-return characteristics to create or "capture" the value increase
        in that
        stage. The seven stages in the model are: land banking, land packaging, land development, building development,
        building operation, building renovation, and site redevelopment. Each stage in the process begins with the
        acquisition tasks and ends with the disposition tasks. Each stage must also address, to some extent, the
        following categories of tasks (many of which are done simultaneously): financing, market research, approvals,
        environmental, improvement construction, and transportation and accessibility concerns. As with all real world
        applications of conceptual
        models, the lines separating the stages and the categories are fuzzy.</p>

    <p>The Development Matrix can be used as a descriptive, normative, or predictive model. As a pedagogical tool, the
        Development matrix can help the student understand the process, risks, and value creation in real estate
        development. If you click on any blue link in the Matrix below, it will take you to a detailed explanation</p>

    <div id="matrix">
        <!--THIS CONTENT WILL BE SERVED VIA NAVIGATION SCRIPTS-->
    </div>

  <a href="#" class="toggle--modal">Modal trigger</a>
</div>

<div class="modal__overlay">
  <div class="modal__wrap">
    <div class="modal__navigation">
      <a href="#" class="modal__button toggle--modal icon-close">Close Modal</a>
      <a href="#" id="upBtn" type="button" onclick="incrementContent(0, -1)" class="modal__button modal__button--top icon-arrow-up-circle">Navigate to Cell Above</a>
      <a href="#" id="leftBtn" type="button" onclick="incrementContent(-1, 0)" class="modal__button modal__button--left icon-arrow-left-circle">Navigate to Cell Left</a>
      <a href="#" id="rightBtn" type="button" onclick="incrementContent(1, 0)" class="modal__button modal__button--right icon-arrow-right-circle">Navigate to Cell Right</a>
      <a href="#" id="downBtn" type="button" onclick="incrementContent(0, 1)" class="modal__button modal__button--bottom icon-arrow-down-circle">Navigate to Cell Below</a>
    </div>

    <div id="main-view" class="modal__content">
      <!--THIS CONTENT WILL BE SERVED VIA NAVIGATION SCRIPTS-->
      Unable to Load Content
    </div>

    <div class="comment__list" id="comments">
      <form method='post'>
        Name:<br/>
        <input type='text' name='name' id='name'/>
        <br/>
        Comment:<br/>
        <textarea name='comment' id='comment'></textarea><br/>
        <input type='submit' value='Submit'/>
      </form>
    </div>
  </div>

  <footer>
    Copyright &copy; Granite Road, LLC.
  </footer>

  <script src="js/modal.js"></script>
</div>

<script>

    var MAX_STAGE = 7;
    var MAX_TASKS = 8;

    var currentStage = 1;
    var currentTask = 1;

    var matrix;

    function servePage() {
        try {
            serveMatrix();
        }
        catch (error) {
            alert(error);
        }

        try {
            serveComments();
        }
        catch (error) {
            alert(error);
        }
    }

    function serveMatrix() {

        var dStage = $.get("/matrix/headers/stage");
        var dTask = $.get("/matrix/headers/task");
        $.when(dStage, dTask).done(
                function (stageJson, taskJson) {

                    try {
                        ;
                        var stageHeader = JSON.parse(stageJson[0]).headers;
                        var taskHeader = JSON.parse(taskJson[0]).headers;

                        var stageLength = stageHeader.length;
                        var taskLength = taskHeader.length;


                        var stageHeadingHtml = "<tr><th></th>";
                        for (var i = 0; i < stageLength; i++) {
                            var stageHeadTitle = stageHeader[i].title;
                            stageHeadingHtml += "<th>" + stageHeadTitle + "</th>";
                        }
                        stageHeadingHtml += "</tr>"

                        var taskContent = "";
                        for (var i = 0; i < taskLength; i++) {

                            var taskTitle = taskHeader[i].title;
                            taskContent += "<tr><th>" + taskTitle + "</th>";
                            for (var j = 0; j < stageLength; j++) {
                                var stageTitle = stageHeader[j].title;

                                var combinedTitle = romanize(i + 1) + "." + (j + 1) + " " + stageTitle + " in " + taskTitle;
                                taskContent += "<td onclick='serveContent(" + j + "," + i + ")'>" + combinedTitle + "</td> ";

                            }

                            taskContent += "</tr>";

                        }

                        var matrixContent = stageHeadingHtml + taskContent;
                        var tableWrapper = '<table>' + matrixContent + '</table>';

                        $("#matrix").html(matrixContent);

                    }
                    catch (error) {
                        alert(error);
                    }
                }
        ).fail(function () {
                    alert("Unable to load Matrix")
                });

    }

    function romanize(num) {
        if (!+num)
            return false;
        var digits = String(+num).split(""),
                key = ["", "C", "CC", "CCC", "CD", "D", "DC", "DCC", "DCCC", "CM",
                    "", "X", "XX", "XXX", "XL", "L", "LX", "LXX", "LXXX", "XC",
                    "", "I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX"],
                roman = "",
                i = 3;
        while (i--)
            roman = (key[+digits.pop() + (i * 10)] || "") + roman;
        return Array(+digits.join("") + 1).join("M") + roman;
    }


    function serveContent(stageIndex, taskIndex) {

        currentStage = stageIndex;
        currentTask = taskIndex;

        validateButtons();

        var url = "matrix/stage" + currentStage + "/task" + currentTask;
        var request = $.get(url);
        $.when(request).done(
                function (json) {
                    var content = JSON.parse(json).content;
                    var header = "Stage: " + currentStage + " Task: " + currentTask;
                    var view = header + "<br>" + content;
                    $("#main-view").html(view);
                }).fail(function () {
                    alert("Unable to serve content")
                });
    }

    function incrementContent(stageIncrement, taskIncrement) {

        var stage = currentStage + stageIncrement;
        var task = currentTask + taskIncrement;

        serveContent(stage, task);

    }

    function serveComments() {

        var comments = retrieveComments();

        var insert = "";
        for (var i = 0; i < comments.length; i++) {

            var comment = comments[i].comment;
            var name = comment.name;
            var value = comment.value;

            var nextComment = '<div class="existing-comment">' + value + '</div>';
            insert = insert + nextComment;
        }

        document.getElementById("breakpoint").innerHTML = insert;

    }

    function retrieveComments() {

        var response = '{"comments":[{"comment":{"name":"Kim","value":"I think this could work"}},{"comment":{"name":"Shane","value":"Do you think this could work?"}}]}';

        var comments = JSON.parse(response);
        return comments.comments;
    }


    function validateButtons() {

        //UP
        if (currentTask <= 0) {
            document.getElementById("upBtn").disabled = true;
        }
        else {
            document.getElementById("upBtn").disabled = false;
        }

        //DOWN
        if (currentTask >= MAX_TASKS-1) {
            document.getElementById("downBtn").disabled = true;
        }
        else {
            document.getElementById("downBtn").disabled = false;
        }

        //LEFT
        if (currentStage <= 0) {
            document.getElementById("leftBtn").disabled = true;
        }
        else {
            document.getElementById("leftBtn").disabled = false;
        }

        //RIGHT
        if (currentStage >= MAX_STAGE-1) {
            document.getElementById("rightBtn").disabled = true;
        }
        else {
            document.getElementById("rightBtn").disabled = false;
        }


    }

</script>


</body>
</html>